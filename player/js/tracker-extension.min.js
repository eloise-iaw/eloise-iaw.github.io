"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7232],{63062:(e,t)=>{t.TRACKER_LOAD_DATA="TRACKER_LOAD_DATA",t.TRACKER_SAVE_SESSION="TRACKER_SAVE_SESSION",t.SET_TRACKER_AUTH="SET_TRACKER_AUTH",t.SAVE_TRACKER_DONE="SAVE_TRACKER_DONE",t.trackerLoadData=e=>({type:t.TRACKER_LOAD_DATA,payload:e}),t.trackerSaveSession=e=>({type:t.TRACKER_SAVE_SESSION,payload:e}),t.setTrackerAuth=e=>({type:t.SET_TRACKER_AUTH,payload:e}),t.saveTrackingDone=e=>({type:t.SAVE_TRACKER_DONE,payload:e})},87862:(e,t,r)=>{var a=r(39322);const{Observable:c}=r(28761),n=r(72579),o=r(2784),{ajax:i}=r(90221),s=r(90876),p=r(58335),{addElement:_}=r(51777),{adjustNavigationHeight:l}=r(75758),{COMPONENT_COMPLETED:E,COMPONENT_TRACKABLE_CHANGE:d}=r(29933),{TRACKABLE_CHANGE:u}=r(59828),{WINDOW_UNLOAD:g,WINDOW_BEFORE_UNLOAD:k}=r(36498),{DATA_READY:A,APP_STARTED:T,setAppReadyState:S,setLearner:f}=r(63444),{setTracking:R,getTrackingImmediately:y}=r(84491),m=r(2462),{trackerLoadData:C,trackerSaveSession:D,setTrackerAuth:v,saveTrackingDone:O,TRACKER_LOAD_DATA:b,TRACKER_SAVE_SESSION:N,SET_TRACKER_AUTH:w}=r(63062);let h=null;function L(e,t){const{config:r,tracker:a}=t.getState();return"exceed"===r._tracker._platform?function(e,t,r){if(r){const r=`${t._pushData}/${h}`;return i.put(r,e,{"Content-Type":"application/json"}).catch((e=>(console.log("tracker:error",e),c.empty())))}return c.empty()}(e,r._tracker,a.authenticated):function(e,t){const r=e._user,a=e._course,c=`${t._pushData}/${r}/${a}`;return i.put(c,e,{"Content-Type":"application/json"}).catch((e=>{n(e,"response._isLoginRequired",!1)&&window.location.reload()}))}(e,r._tracker)}t.trackerSetupEpic=(e,t)=>e.filter((e=>{if(e.type!==A)return!1;const{app:r,config:a}=t.getState(),c=a._tracker;return!r.isLivePreview&&c&&c._isEnabled})).take(1).mergeMap((()=>c.of(S("tracker",!1),C()))).catch((e=>(console.warn("Tracker extension error: ",e),S("tracker",!0)))),t.trackerLoadDataEpic=(e,t)=>e.ofType(b).mergeMap((()=>{const{config:e}=t.getState(),r=e._tracker;return"exceed"===r._platform?function(e,t){const{inline:r}=t.getState(),a=function(e,t){if(t)return n(window,"evolve.courseId");e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");const r=new RegExp(`[\\?&]${e}=([^&#]*)`).exec(window.location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}("_courseId",r.isEnabled);return a||window.location.replace("/404"),c.forkJoin(i.getJSON(`${e._auth}?course_id=${a}`),i.getJSON("/monitor/heartbeat")).mergeMap((([e,t])=>{if(e.authenticated){const r=1e3*t,a=(new Date).getTime();window.TIME_DIFFERENCE=a-r;const{user_id:n,first_name:o,last_name:i}=e;return c.of(f({_id:n,firstName:o,lastName:i,userData:e}),v(e))}return c.of(v({authenticated:!1}))})).catch((e=>{console.log("error",e)}))}(r,t):function(e,t){return c.bindCallback(a.getScript)("../../bloom/bloomAPI.js").mergeMap((()=>{if(window.BLOOM_API)return c.bindCallback(window.BLOOM_API.init)({store:t,actions:{addElement:_,adjustNavigationHeight:l,trackerSaveSession:D},libraries:{React:o,Observable:c,createReactClass:p},player:s})})).mergeMap((()=>i.getJSON(e._auth))).mergeMap((e=>c.of(v(e)))).catch((e=>{console.log("error",e)}))}(r,t)})),t.trackerTrackEpic=(e,t)=>e.filter((e=>{const{app:r,config:a}=t.getState();if(e.type===E||e.type===d||e.type===T||e.type===N||e.type===u){const e=a._tracker;return!r.isLivePreview&&e&&e._isEnabled}return!1})).do((({type:e})=>console.log("tracker:trigger",e))).debounce((({type:e})=>{let r=5e3;return(e===N||m(t.getState()))&&(r=0),c.timer(r)})).takeUntil(e.ofType(g,k)).switchMap((()=>L(y(),t).catch((e=>(console.log("tracker:error",e),c.empty()))))).map((()=>O())).do((()=>console.log("tracker:saved"))),t.trackerWindowUnloadEpic=(e,t)=>e.ofType(g,k).take(1).filter((()=>{const{app:e,config:r,inline:a}=t.getState(),c=r._tracker,n=null==a?void 0:a.isEnabled;return!e.isLivePreview&&n&&c&&c._isEnabled})).mergeMap((()=>L(y(),t))).map((()=>O())),t.trackerTrackDevEpic=(e,t)=>e.filter((e=>{const{app:r,tracking:a}=t.getState();return(e.type===E||e.type===d||e.type===T||e.type===g||e.type===N||e.type===u)&&r.isLivePreview&&a._isTrackingDevLogEnabled})).mergeMap((e=>(console.log(`TRACKER - action type:${e.type}`,y()),c.empty()))),t.trackerLoadTrackingEpic=(e,t)=>e.ofType(w).mergeMap((()=>{const{config:e}=t.getState();return"exceed"===e._tracker._platform?function(e){const{config:t,tracker:r}=e.getState();if(r.authenticated&&r.enrollment_course_activity_id&&r.user_id){h=r.enrollment_course_activity_id;const n=`/evolve/api/v1/enrollment_course_activities/${h}/decorator.js`;return c.bindCallback(a.getScript)(n).mergeMap((()=>{if(window.EXCEED_API)return c.bindCallback(window.EXCEED_API.init)({store:e,actions:{addElement:_,adjustNavigationHeight:l,trackerSaveSession:D},libraries:{React:o,Observable:c,createReactClass:p},player:s})})).mergeMap((()=>{const e=`${t._tracker._getData}/${h}`;return i.getJSON(e)})).mergeMap((e=>(R(e,!0),c.of(S("tracker",!0)))))}return c.of(S("tracker",!0))}(t):function(e){const{config:t,tracker:r}=e.getState(),a=t._courseId,n=`${t._tracker._getData}/${r._user._id}/${a}`;return i.getJSON(n).mergeMap((e=>{R(e,!0);const{_id:t,firstName:a,lastName:n}=r._user;return c.of(S("tracker",!0),f({_id:t,firstName:a,lastName:n}))}))}(t)}))},51563:(e,t,r)=>{const a=r(60019),{FETCH_COURSE_DATA:c}=r(63444),{SET_TRACKER_AUTH:n}=r(63062),o={_isEnabled:!1,_auth:{}};e.exports=(e=o,t)=>t.type===c&&t.payload.config._tracker&&t.payload.config._tracker._isEnabled?a({},e,{_isEnabled:!0}):e._isEnabled?t.type===n?a({},e,t.payload):e:o},98622:(e,t,r)=>{const{registerEpics:a,registerReducer:c}=r(90876),n=r(51563),{trackerWindowUnloadEpic:o,trackerSetupEpic:i,trackerLoadDataEpic:s,trackerLoadTrackingEpic:p,trackerTrackEpic:_,trackerTrackDevEpic:l}=r(87862);c("tracker",n),a(o,i,s,p,_,l)}}]);